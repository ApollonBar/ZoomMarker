/*! zoom_marker - v0.0.6 - */

!function(a){var b,c,d,e=!1,f=[],g=0;a.fn.extend({zoomMarker:function(f){if(!e){e=!0,document.ondragstart=function(){return!1},c=a(this);var g;b=void 0===f?r:a.extend({},r,f),document.options=b,null===b.src?console.log("Image resources is not defined."):j(b.src),c.bind("mousewheel",function(a,d){return c.zoomMarker_Zoom({x:a.pageX,y:a.pageY},d>0?1+b.rate:1-b.rate),!1});var h=new Hammer(document.getElementById(a(this).attr("id")));h.on("pan",function(a){b.pinchlock||(d.hide(),c.zoomMarker_Move(a.deltaX+g.left,a.deltaY+g.top))}),h.on("panstart",function(a){g=c.offset()}),h.on("panend",function(a){b.pinchlock=!1}),h.get("pinch").set({enable:!0}),h.on("pinchmove",function(a){d.hide(),c.zoomMarker_Zoom({x:a.center.x,y:a.center.y},a.scale/b.pinchscale),b.pinchscale=a.scale}),h.on("pinchstart",function(a){b.pinchlock=!0,b.pinchscale=1}),d=a("<div id='zoom-marker-hover-dialog' class='zoom-marker-hover-dialog'></div>"),c.parent().append(d),new Hammer(document.getElementById(c.attr("id"))).on("tap",function(a){if(void 0===a.pointers[0].x){var d=c.offset();c.trigger("zoom_marker_mouse_click",{x:(a.center.x-d.left)/c.width()*b.imgNaturalSize.width,y:(a.center.y-d.top)/c.height()*b.imgNaturalSize.height})}else c.trigger("zoom_marker_mouse_click",{pageX:a.pointers[0].offsetX,pageY:a.pointers[0].offsetY,x:a.pointers[0].offsetX/c.width()*b.imgNaturalSize.width,y:a.pointers[0].offsetY/c.height()*b.imgNaturalSize.height})})}},zoomMarker_LoadImage:function(a){j(a,!0)},zoomMarker_Zoom:function(b,c){var d=a(this),e=document.options,f=d.offset(),g=d.height(),h=d.width(),i=h*c;null!=e.max&&(i>e.max||i<e.min)||(d.height(g*c),d.width(i),void 0!==b&&null!==b||(b={},b.x=f.left+h/2,b.y=f.top+g/2),d.offset({top:b.y-d.height()*(b.y-f.top)/g,left:b.x-d.width()*(b.x-f.left)/h}),n())},zoomMarker_Move:function(b,c){a(this).offset({top:c,left:b}),n()},zoomMarker_AddMarker:function(a){return m(a)},zoomMarker_RemoveMarker:function(a){p(a)},zoomMarker_CleanMarker:function(){o()},zoomMarker_GetPicSize:function(){return b.imgNaturalSize},zoomMarker_ImageCenterAlign:function(){k()}});var h=function(a,b){a.onload=null,a.complete?b(i(a)):a.onload=function(){b(i(a))}},i=function(a){if(void 0===a.naturalWidth){var b=new Image;b.src=a.src;var c=b.width,d=b.height}else var c=a.naturalWidth,d=a.naturalHeight;return{width:c,height:d}},j=function(a,d){c.trigger("zoom_marker_img_load",a),c.attr("src",a),h(document.getElementsByName(c.attr("name"))[0],function(a){if(void 0===d||!d){var e=c.width(),f=c.height();null!=b.width&&(c.width(b.width),c.height(c.width()/e*f))}c.trigger("zoom_marker_img_loaded",a),void 0!==d&&d||k(),b.imgNaturalSize=a,l(b.markers)})},k=function(){var a=c.offset(),b=c.parent(),d=a.top+(b.height()-c.height())/2,e=a.left+(b.width()-c.width())/2;c.offset({top:d>0?d:0,left:e>0?e:0})},l=function(b){a(b).each(function(a,b){m(b)})},m=function(e){var h=a("<div class='zoom-marker'><img draggable='false'><span></span></div>"),i=h.find("img"),j=e.size||b.marker_size;if(e.size=j,i.attr("src",e.src),void 0!==e.hint){var k=h.find("span");k.empty().append(e.hint.value||""),k.css(e.hint.style||{})}i.height(j),i.width(j);var l={id:g++,marker:h,param:e};return h.click(function(){void 0!==e.click&&e.click(l),c.trigger("zoom_marker_click",l)}),void 0!==e.dialog&&(h.mousemove(function(a){b.hover_marker_id=l.id,d.empty().append(e.dialog.value||"").css(e.dialog.style||{}).show().offset({left:(e.dialog.offsetX||0)+a.pageX,top:(e.dialog.offsetY||0)+a.pageY})}),h.mouseout(function(a){b.hover_marker_id=null,d.hide()})),c.parent().append(h),f.push(l),q(h,e,c.offset()),l},n=function(){var b=c.offset();a(f).each(function(a,c){q(c.marker,c.param,b)})},o=function(){a(f).each(function(a,b){b.marker.unbind(),b.marker.remove()}),f=[],b.markers=[],d.hide()},p=function(c){a(f).each(function(a,e){if(e.id===c)return e.marker.unbind(),e.marker.remove(),null!=(b.hover_marker_id||null)&&b.hover_marker_id===c&&d.hide(),!1})},q=function(a,d,e){a.offset({left:c.width()*d.x/b.imgNaturalSize.width+e.left-d.size/2,top:c.height()*d.y/b.imgNaturalSize.height+e.top-d.size})},r={rate:.2,src:null,width:500,min:300,max:null,markers:[],marker_size:20}}(window.jQuery);